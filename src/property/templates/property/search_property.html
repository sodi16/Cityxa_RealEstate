{% load static %}

{% include 'users/header_page.html' %}

<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <title>Map</title>
        <style>
  .container {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: flex-start;
    height: 500px;
    width: 100%;
  }

  .map {
    width: 600px;
    height: 500px;
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
  }

  .description {
    width: calc(100% - 600px);
    height: 500px;
    overflow-y: auto;
  }


    .property-search {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      margin-bottom: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      overflow: hidden;
      border-radius: 10px;
      background: #fff;
    }

    .property-details {
      flex: 1;
    }

    .property-image {
      margin-left: 20px;
    }

    .property-image img {
      width: 250px;
      height: auto;
    }


    .property-details h3 {
      margin: 0;
      font-size: 18px;
    }

    .property-details p {
      margin: 5px 0;
      font-size: 14px;
    }

    .property-details .adress {
      font-style: italic;
    }
    .back-button {
     padding: 10px 20px;
     border-radius: 8px;
     box-shadow: 2px 2px 2px 1px rgb(131, 131, 219) ;
     border: 1px solid gray;
     font-size: 15px;
 }

    .filter-form {
      display: flex;
      width: 90%;
      height: 50px;
      margin: 0 auto;
      justify-content: space-between;
      align-items: center;
      background: #fff;
      border-radius: 8px;
      border: 1px solid gray;

    }

    .filter-form label {
      margin-right: 10px;
    }

    .filter-form button {
      background-color: #007bff;
      color: #fff;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
    }

    </style>
</head>
<body>
{% include 'property/search_bar_hidden.html' %}

<div style="display:none">
    <img src="{% static 'images/house_marker.png' %}" id="house_marker">`
</div>
<div class="container" style="display: flex;">
<div id="map" style="position: fixed; height: 500px; width: 650px;"></div>

    <script>
    function initMap() {
        var mapOptions = {
            center: { lat: {{latitude}}, lng: {{longitude}} },
            zoom: 8,
            styles: [
                {
                    featureType: 'poi',
                    stylers: [{ visibility: 'off' }]
                },
                {
                    featureType: 'transit',
                    elementType: 'labels.icon',
                    stylers: [{ visibility: 'off' }]
                }
            ]
        };

        function createMarker(point) {
            var marker = new google.maps.Marker({
                position: point,
                map: map,
                icon: {
                    url: document.getElementById('house_marker').src
                }

            });
            marker.addListener('click', function() {
                infoWindow.setContent(point.info);
                infoWindow.open(map, marker);
            });
            return marker;
        }

        var map = new google.maps.Map(document.getElementById('map'), mapOptions);
        var infoWindow = new google.maps.InfoWindow();

        var markers = [];
        {% for obj in properties %}
            var point{{ forloop.counter }} = {
                lat: {{ obj.adress.latitude }},
                lng: {{ obj.adress.longitude }},
                info: '<h3>{{obj.adress}}</h3>' +
                '<a href="{% url 'display_property' pk=obj.pk %}">'+
                '<img src="{{ obj.images.all.0.image.url }}" alt="Property {{obj.adress.city}}" style="width: 130px; height: 85px;"></a>' +
                '<p><b>Bedrooms:</b> {{obj.num_rooms}} | <b>Area:</b> {{obj.area}}sqm | <b>Type</b>: {{obj.display_type_of_property}}</p>'
            };
            markers.push(createMarker(point{{ forloop.counter }}));
        {% endfor %}

    }
</script>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBnS3spzxsJEEvQG6kVRHpPeRIyiQB0X_8&callback=initMap"></script>


  <div style="flex: 1; padding: 0 10px; overflow-y: auto; height: 500px;">
    {% for obj in properties %}
    <div class="property-search">
      <div class="property-details">
        <h3>{{ obj.adress }}</h3>
        <p class="adress">{{ obj.adress }}</p>
          <p class="price"><b>Price:</b>{{ obj.price }}</p>
          <p class="num-rooms"><b>Number of rooms:</b>{{ obj.num_rooms }} rooms</p>
          <p class="area"><b>Area:</b>{{ obj.area }} sqm</p>
          <p class="area"><b>Description:</b>{{ obj.description | truncatechars:65 }} </p>
      </div>
      <div class="property-image">
          <a href="{% url 'display_property' pk=obj.pk %}">
            <img src="{{ obj.images.all.0.image.url }}" alt="{{ obj.title }}">
          </a>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
<form method="get">
    <div class="filter-form">
    <label for="filter-by-type">Filter by Type:</label>
    <select  name="type[]" id="filter-by-type">
      <option value="">-- Select Type --</option>
    </select>

<!--        {{ form.id_type_of_property}}-->
<!--        {{ form.num_rooms}}-->

    <label for="filter-by-price">Price:</label>
    <input type="checkbox" name="price[]" value="0-500" id="filter-by-price">

    <label for="filter-by-bedroom">Num of bedroom:</label>
    <input type="radio" name="bedroom" value="1" id="filter-by-bedroom">

    <button type="submit" class="filter-button">Filter</button>
  </div>
  </form>
</body>
